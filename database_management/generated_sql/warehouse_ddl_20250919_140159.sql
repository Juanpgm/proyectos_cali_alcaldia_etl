-- ==============================================\n-- DDL COMPLETO PARA DATA WAREHOUSE\n-- Alcaldía de Santiago de Cali ETL\n-- Generado: 2025-09-19T14:01:59.073164\n-- ==============================================\n\n
-- ==============================================
-- CONFIGURACIÓN INICIAL DEL DATA WAREHOUSE
-- Alcaldía de Santiago de Cali ETL
-- ==============================================

-- Extensiones necesarias
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "postgis";
CREATE EXTENSION IF NOT EXISTS "pg_stat_statements";
CREATE EXTENSION IF NOT EXISTS "btree_gin";

-- Configuraciones de warehouse
SET timezone = 'America/Bogota';
SET datestyle = 'ISO, YMD';

-- Schema para datos de staging
CREATE SCHEMA IF NOT EXISTS staging;
COMMENT ON SCHEMA staging IS 'Schema para datos temporales y staging';

-- Schema para datos históricos
CREATE SCHEMA IF NOT EXISTS historical;
COMMENT ON SCHEMA historical IS 'Schema para datos históricos y auditoria';

-- Schema para vistas materializadas
CREATE SCHEMA IF NOT EXISTS analytics;
COMMENT ON SCHEMA analytics IS 'Schema para vistas materializadas y analytics';

-- Función para logging de cambios
CREATE OR REPLACE FUNCTION log_data_change()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO historical.change_log (
        table_name,
        operation,
        old_data,
        new_data,
        changed_by,
        changed_at
    ) VALUES (
        TG_TABLE_NAME,
        TG_OP,
        CASE WHEN TG_OP = 'DELETE' THEN row_to_json(OLD) ELSE NULL END,
        CASE WHEN TG_OP = 'INSERT' OR TG_OP = 'UPDATE' THEN row_to_json(NEW) ELSE NULL END,
        current_user,
        CURRENT_TIMESTAMP
    );
    
    RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

-- Tabla de log de cambios
CREATE TABLE IF NOT EXISTS historical.change_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    table_name TEXT NOT NULL,
    operation TEXT NOT NULL,
    old_data JSONB,
    new_data JSONB,
    changed_by TEXT NOT NULL,
    changed_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IF NOT EXISTS idx_change_log_table_name ON historical.change_log (table_name);
CREATE INDEX IF NOT EXISTS idx_change_log_changed_at ON historical.change_log (changed_at);
CREATE INDEX IF NOT EXISTS idx_change_log_operation ON historical.change_log (operation);

\n\n-- ==============================================\n-- Tabla: contratos_proyectos\n-- Descripción: Tabla generada automáticamente desde contratos_proyectos.json\n-- Generado: 2025-09-19T14:01:59.073164\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS contratos_proyectos (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    nombre_entidad VARCHAR(118) NOT NULL,\n    sector VARCHAR(50) NOT NULL,\n    entidad_centralizada VARCHAR(15) NOT NULL,\n    proceso_compra VARCHAR(16) NOT NULL,\n    id_contrato TIMESTAMP WITH TIME ZONE NOT NULL,\n    referencia_contrato VARCHAR(36) NOT NULL,\n    estado_contrato VARCHAR(17) NOT NULL,\n    codigo_categoria_principal VARCHAR(11) NOT NULL,\n    descripcion_proceso TIMESTAMP WITH TIME ZONE NOT NULL,\n    tipo_contrato VARCHAR(30) NOT NULL,\n    modalidad_contratacion VARCHAR(59) NOT NULL,\n    justificacion_modalidad_contratacion TIMESTAMP WITH TIME ZONE NOT NULL,\n    fecha_firma DATE,\n    fecha_inicio_contrato DATE,\n    fecha_fin_contrato DATE,\n    fecha_inicio_ejecucion TEXT,\n    fecha_fin_ejecucion TEXT,\n    tipodocproveedor VARCHAR(21) NOT NULL,\n    documento_proveedor INTEGER NOT NULL,\n    proveedor_adjudicado VARCHAR(119) NOT NULL,\n    es_grupo BOOLEAN NOT NULL,\n    es_pyme VARCHAR(2) NOT NULL,\n    habilita_pago_adelantado BOOLEAN NOT NULL,\n    liquidaci_n BOOLEAN NOT NULL,\n    obligaci_n_ambiental BOOLEAN NOT NULL,\n    obligaciones_postconsumo BOOLEAN NOT NULL,\n    reversion BOOLEAN NOT NULL,\n    origen_recursos VARCHAR(11) NOT NULL,\n    destino_gasto VARCHAR(14) NOT NULL,\n    valor_contrato INTEGER NOT NULL,\n    valor_pago_adelantado BOOLEAN NOT NULL,\n    valor_facturado BOOLEAN NOT NULL,\n    valor_pendiente_pago INTEGER NOT NULL,\n    valor_pagado BOOLEAN NOT NULL,\n    valor_amortizado BOOLEAN NOT NULL,\n    valor_pendiente_amortizacion BOOLEAN NOT NULL,\n    valor_pendiente_ejecucion INTEGER NOT NULL,\n    estado_bpin VARCHAR(6) NOT NULL,\n    bpin TIMESTAMP WITH TIME ZONE NOT NULL,\n    anno_bpin INTEGER NOT NULL,\n    saldo_cdp INTEGER NOT NULL,\n    saldo_vigencia BOOLEAN NOT NULL,\n    espostconflicto BOOLEAN NOT NULL,\n    dias_adicionados BOOLEAN NOT NULL,\n    puntos_acuerdo VARCHAR(9) NOT NULL,\n    pilares_acuerdo VARCHAR(9) NOT NULL,\n    urlproceso TEXT NOT NULL,\n    nombre_representante_legal VARCHAR(80) NOT NULL,\n    nacionalidad_representante_legal VARCHAR(11) NOT NULL,\n    domicilio_representante_legal VARCHAR(85) NOT NULL,\n    tipo_identificaci_n_representante_legal VARCHAR(21) NOT NULL,\n    identificaci_n_representante_legal VARCHAR(17) NOT NULL,\n    g_nero_representante_legal VARCHAR(11) NOT NULL,\n    presupuesto_general_nacion_pgn BOOLEAN NOT NULL,\n    sistema_general_participaciones BOOLEAN NOT NULL,\n    sistema_general_regal_as BOOLEAN NOT NULL,\n    recursos_propios_alcald_as_gobernaciones_resguardos_ind_genas INTEGER NOT NULL,\n    recursos_credito BOOLEAN NOT NULL,\n    recursos_propios BOOLEAN NOT NULL,\n    ultima_actualizacion TIMESTAMP WITH TIME ZONE,\n    codigo_entidad VARCHAR(11) NOT NULL,\n    codigo_proveedor INTEGER NOT NULL,\n    fecha_inicio_liquidacion DATE,\n    fecha_fin_liquidacion DATE,\n    objeto_contrato TIMESTAMP WITH TIME ZONE NOT NULL,\n    duraci_n_contrato TIMESTAMP WITH TIME ZONE NOT NULL,\n    nombre_banco VARCHAR(43) NOT NULL,\n    tipo_cuenta VARCHAR(11) NOT NULL,\n    n_mero_cuenta VARCHAR(45) NOT NULL,\n    contrato_puede_ser_prorrogado BOOLEAN NOT NULL,\n    fecha_notificaci_n_prorrogaci_n DATE,\n    nombre_ordenador_gasto VARCHAR(34) NOT NULL,\n    tipo_documento_ordenador_gasto VARCHAR(20) NOT NULL,\n    n_mero_documento_ordenador_gasto INTEGER NOT NULL,\n    nombre_supervisor VARCHAR(38) NOT NULL,\n    tipo_documento_supervisor VARCHAR(20) NOT NULL,\n    n_mero_documento_supervisor VARCHAR(13) NOT NULL,\n    nombre_ordenador_pago BOOLEAN NOT NULL,\n    tipo_documento_ordenador_pago BOOLEAN NOT NULL,\n    n_mero_documento_ordenador_pago BOOLEAN NOT NULL\n);\n\n-- Índices para tabla: contratos_proyectos\n\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_created_at ON contratos_proyectos (created_at);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_updated_at ON contratos_proyectos (updated_at);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_active ON contratos_proyectos (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_nombre_entidad_analytics ON contratos_proyectos (nombre_entidad);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_estado_contrato_analytics ON contratos_proyectos (estado_contrato);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_codigo_categoria_principal_analytics ON contratos_proyectos (codigo_categoria_principal);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_tipo_contrato_analytics ON contratos_proyectos (tipo_contrato);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_firma_analytics ON contratos_proyectos (fecha_firma);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_inicio_contrato_analytics ON contratos_proyectos (fecha_inicio_contrato);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_fin_contrato_analytics ON contratos_proyectos (fecha_fin_contrato);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_inicio_ejecucion_analytics ON contratos_proyectos (fecha_inicio_ejecucion);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_fin_ejecucion_analytics ON contratos_proyectos (fecha_fin_ejecucion);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_tipodocproveedor_analytics ON contratos_proyectos (tipodocproveedor);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_estado_bpin_analytics ON contratos_proyectos (estado_bpin);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_bpin_analytics ON contratos_proyectos (bpin);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_anno_bpin_analytics ON contratos_proyectos (anno_bpin);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_nombre_representante_legal_analytics ON contratos_proyectos (nombre_representante_legal);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_tipo_identificaci_n_representante_legal_analytics ON contratos_proyectos (tipo_identificaci_n_representante_legal);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_codigo_entidad_analytics ON contratos_proyectos (codigo_entidad);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_codigo_proveedor_analytics ON contratos_proyectos (codigo_proveedor);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_inicio_liquidacion_analytics ON contratos_proyectos (fecha_inicio_liquidacion);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_fin_liquidacion_analytics ON contratos_proyectos (fecha_fin_liquidacion);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_nombre_banco_analytics ON contratos_proyectos (nombre_banco);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_tipo_cuenta_analytics ON contratos_proyectos (tipo_cuenta);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_fecha_notificaci_n_prorrogaci_n_analytics ON contratos_proyectos (fecha_notificaci_n_prorrogaci_n);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_nombre_ordenador_gasto_analytics ON contratos_proyectos (nombre_ordenador_gasto);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_tipo_documento_ordenador_gasto_analytics ON contratos_proyectos (tipo_documento_ordenador_gasto);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_nombre_supervisor_analytics ON contratos_proyectos (nombre_supervisor);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_tipo_documento_supervisor_analytics ON contratos_proyectos (tipo_documento_supervisor);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_nombre_ordenador_pago_analytics ON contratos_proyectos (nombre_ordenador_pago);\nCREATE INDEX IF NOT EXISTS idx_contratos_proyectos_tipo_documento_ordenador_pago_analytics ON contratos_proyectos (tipo_documento_ordenador_pago);\n\n-- Constraints para tabla: contratos_proyectos\n\nALTER TABLE contratos_proyectos ADD CONSTRAINT chk_contratos_proyectos_fecha_inicio_contrato_reasonable\n    CHECK (fecha_inicio_contrato >= '2000-01-01');\n\nALTER TABLE contratos_proyectos ADD CONSTRAINT chk_contratos_proyectos_valor_contrato_positive\n    CHECK (valor_contrato >= 0);\n\nALTER TABLE contratos_proyectos ADD CONSTRAINT chk_contratos_proyectos_valor_pendiente_pago_positive\n    CHECK (valor_pendiente_pago >= 0);\n\nALTER TABLE contratos_proyectos ADD CONSTRAINT chk_contratos_proyectos_valor_pendiente_ejecucion_positive\n    CHECK (valor_pendiente_ejecucion >= 0);\n\nALTER TABLE contratos_proyectos ADD CONSTRAINT chk_contratos_proyectos_fecha_inicio_liquidacion_reasonable\n    CHECK (fecha_inicio_liquidacion >= '2000-01-01');\n\n
-- Trigger para actualizar timestamp automáticamente en contratos_proyectos
CREATE OR REPLACE FUNCTION update_contratos_proyectos_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_contratos_proyectos_timestamp ON contratos_proyectos;
CREATE TRIGGER trigger_update_contratos_proyectos_timestamp
    BEFORE UPDATE ON contratos_proyectos
    FOR EACH ROW
    EXECUTE FUNCTION update_contratos_proyectos_timestamp();

\n-- Comentarios para tabla: contratos_proyectos\n\nCOMMENT ON TABLE contratos_proyectos IS 'Tabla generada automáticamente desde contratos_proyectos.json';\n\nCOMMENT ON COLUMN contratos_proyectos.nombre_entidad IS 'Campo nombre_entidad (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.sector IS 'Campo sector (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.entidad_centralizada IS 'Campo entidad_centralizada (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.proceso_compra IS 'Campo proceso_compra (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.id_contrato IS 'Campo id_contrato (Tipo: datetime)';\nCOMMENT ON COLUMN contratos_proyectos.referencia_contrato IS 'Campo referencia_contrato (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.estado_contrato IS 'Campo estado_contrato (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.codigo_categoria_principal IS 'Campo codigo_categoria_principal (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.descripcion_proceso IS 'Campo descripcion_proceso (Tipo: datetime)';\nCOMMENT ON COLUMN contratos_proyectos.tipo_contrato IS 'Campo tipo_contrato (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.modalidad_contratacion IS 'Campo modalidad_contratacion (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.justificacion_modalidad_contratacion IS 'Campo justificacion_modalidad_contratacion (Tipo: datetime)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_firma IS 'Campo fecha_firma (Tipo: date)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_inicio_contrato IS 'Campo fecha_inicio_contrato (Tipo: date)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_fin_contrato IS 'Campo fecha_fin_contrato (Tipo: date)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_inicio_ejecucion IS 'Campo fecha_inicio_ejecucion (Tipo: unknown)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_fin_ejecucion IS 'Campo fecha_fin_ejecucion (Tipo: unknown)';\nCOMMENT ON COLUMN contratos_proyectos.tipodocproveedor IS 'Campo tipodocproveedor (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.documento_proveedor IS 'Campo documento_proveedor (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.proveedor_adjudicado IS 'Campo proveedor_adjudicado (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.es_grupo IS 'Campo es_grupo (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.es_pyme IS 'Campo es_pyme (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.habilita_pago_adelantado IS 'Campo habilita_pago_adelantado (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.liquidaci_n IS 'Campo liquidaci_n (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.obligaci_n_ambiental IS 'Campo obligaci_n_ambiental (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.obligaciones_postconsumo IS 'Campo obligaciones_postconsumo (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.reversion IS 'Campo reversion (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.origen_recursos IS 'Campo origen_recursos (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.destino_gasto IS 'Campo destino_gasto (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.valor_contrato IS 'Campo valor_contrato (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.valor_pago_adelantado IS 'Campo valor_pago_adelantado (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.valor_facturado IS 'Campo valor_facturado (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.valor_pendiente_pago IS 'Campo valor_pendiente_pago (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.valor_pagado IS 'Campo valor_pagado (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.valor_amortizado IS 'Campo valor_amortizado (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.valor_pendiente_amortizacion IS 'Campo valor_pendiente_amortizacion (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.valor_pendiente_ejecucion IS 'Campo valor_pendiente_ejecucion (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.estado_bpin IS 'Campo estado_bpin (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.bpin IS 'Campo bpin (Tipo: timestamp)';\nCOMMENT ON COLUMN contratos_proyectos.anno_bpin IS 'Campo anno_bpin (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.saldo_cdp IS 'Campo saldo_cdp (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.saldo_vigencia IS 'Campo saldo_vigencia (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.espostconflicto IS 'Campo espostconflicto (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.dias_adicionados IS 'Campo dias_adicionados (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.puntos_acuerdo IS 'Campo puntos_acuerdo (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.pilares_acuerdo IS 'Campo pilares_acuerdo (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.urlproceso IS 'Campo urlproceso (Tipo: url)';\nCOMMENT ON COLUMN contratos_proyectos.nombre_representante_legal IS 'Campo nombre_representante_legal (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.nacionalidad_representante_legal IS 'Campo nacionalidad_representante_legal (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.domicilio_representante_legal IS 'Campo domicilio_representante_legal (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.tipo_identificaci_n_representante_legal IS 'Campo tipo_identificaci_n_representante_legal (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.identificaci_n_representante_legal IS 'Campo identificaci_n_representante_legal (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.g_nero_representante_legal IS 'Campo g_nero_representante_legal (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.presupuesto_general_nacion_pgn IS 'Campo presupuesto_general_nacion_pgn (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.sistema_general_participaciones IS 'Campo sistema_general_participaciones (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.sistema_general_regal_as IS 'Campo sistema_general_regal_as (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.recursos_propios_alcald_as_gobernaciones_resguardos_ind_genas IS 'Campo recursos_propios_alcald_as_gobernaciones_resguardos_ind_genas (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.recursos_credito IS 'Campo recursos_credito (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.recursos_propios IS 'Campo recursos_propios (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.ultima_actualizacion IS 'Campo ultima_actualizacion (Tipo: datetime)';\nCOMMENT ON COLUMN contratos_proyectos.codigo_entidad IS 'Campo codigo_entidad (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.codigo_proveedor IS 'Campo codigo_proveedor (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_inicio_liquidacion IS 'Campo fecha_inicio_liquidacion (Tipo: date)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_fin_liquidacion IS 'Campo fecha_fin_liquidacion (Tipo: date)';\nCOMMENT ON COLUMN contratos_proyectos.objeto_contrato IS 'Campo objeto_contrato (Tipo: datetime)';\nCOMMENT ON COLUMN contratos_proyectos.duraci_n_contrato IS 'Campo duraci_n_contrato (Tipo: datetime)';\nCOMMENT ON COLUMN contratos_proyectos.nombre_banco IS 'Campo nombre_banco (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.tipo_cuenta IS 'Campo tipo_cuenta (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.n_mero_cuenta IS 'Campo n_mero_cuenta (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.contrato_puede_ser_prorrogado IS 'Campo contrato_puede_ser_prorrogado (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.fecha_notificaci_n_prorrogaci_n IS 'Campo fecha_notificaci_n_prorrogaci_n (Tipo: date)';\nCOMMENT ON COLUMN contratos_proyectos.nombre_ordenador_gasto IS 'Campo nombre_ordenador_gasto (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.tipo_documento_ordenador_gasto IS 'Campo tipo_documento_ordenador_gasto (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.n_mero_documento_ordenador_gasto IS 'Campo n_mero_documento_ordenador_gasto (Tipo: integer)';\nCOMMENT ON COLUMN contratos_proyectos.nombre_supervisor IS 'Campo nombre_supervisor (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.tipo_documento_supervisor IS 'Campo tipo_documento_supervisor (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.n_mero_documento_supervisor IS 'Campo n_mero_documento_supervisor (Tipo: varchar)';\nCOMMENT ON COLUMN contratos_proyectos.nombre_ordenador_pago IS 'Campo nombre_ordenador_pago (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.tipo_documento_ordenador_pago IS 'Campo tipo_documento_ordenador_pago (Tipo: boolean)';\nCOMMENT ON COLUMN contratos_proyectos.n_mero_documento_ordenador_pago IS 'Campo n_mero_documento_ordenador_pago (Tipo: boolean)';\n\n\n\n-- ==============================================\n-- Tabla: datos_caracteristicos_proyectos\n-- Descripción: Tabla generada automáticamente desde datos_caracteristicos_proyectos.json\n-- Generado: 2025-09-19T14:01:59.074206\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS datos_caracteristicos_proyectos (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    bpin TIMESTAMP WITH TIME ZONE NOT NULL,\n    bp VARCHAR(10) PRIMARY KEY NOT NULL,\n    nombre_proyecto VARCHAR(264) NOT NULL,\n    nombre_actividad VARCHAR(294) NOT NULL,\n    programa_presupuestal VARCHAR(17) NOT NULL,\n    nombre_centro_gestor VARCHAR(81) NOT NULL,\n    nombre_area_funcional VARCHAR(271) NOT NULL,\n    nombre_fondo VARCHAR(111) NOT NULL,\n    clasificacion_fondo VARCHAR(43) NOT NULL,\n    nombre_pospre VARCHAR(152) NOT NULL,\n    nombre_dimension VARCHAR(30),\n    nombre_linea_estrategica VARCHAR(54),\n    nombre_programa VARCHAR(95) NOT NULL,\n    comuna VARCHAR(16) NOT NULL,\n    origen VARCHAR(22) NOT NULL,\n    anio INTEGER NOT NULL,\n    tipo_gasto VARCHAR(9) NOT NULL,\n    cod_sector INTEGER,\n    cod_producto INTEGER,\n    validador_cuipo TEXT\n);\n\n-- Índices para tabla: datos_caracteristicos_proyectos\n\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_created_at ON datos_caracteristicos_proyectos (created_at);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_updated_at ON datos_caracteristicos_proyectos (updated_at);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_active ON datos_caracteristicos_proyectos (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_bpin_analytics ON datos_caracteristicos_proyectos (bpin);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_proyecto_analytics ON datos_caracteristicos_proyectos (nombre_proyecto);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_actividad_analytics ON datos_caracteristicos_proyectos (nombre_actividad);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_centro_gestor_analytics ON datos_caracteristicos_proyectos (nombre_centro_gestor);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_area_funcional_analytics ON datos_caracteristicos_proyectos (nombre_area_funcional);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_fondo_analytics ON datos_caracteristicos_proyectos (nombre_fondo);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_pospre_analytics ON datos_caracteristicos_proyectos (nombre_pospre);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_dimension_analytics ON datos_caracteristicos_proyectos (nombre_dimension);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_linea_estrategica_analytics ON datos_caracteristicos_proyectos (nombre_linea_estrategica);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_nombre_programa_analytics ON datos_caracteristicos_proyectos (nombre_programa);\nCREATE INDEX IF NOT EXISTS idx_datos_caracteristicos_proyectos_tipo_gasto_analytics ON datos_caracteristicos_proyectos (tipo_gasto);\n\n-- Constraints para tabla: datos_caracteristicos_proyectos\n\n
-- Trigger para actualizar timestamp automáticamente en datos_caracteristicos_proyectos
CREATE OR REPLACE FUNCTION update_datos_caracteristicos_proyectos_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_datos_caracteristicos_proyectos_timestamp ON datos_caracteristicos_proyectos;
CREATE TRIGGER trigger_update_datos_caracteristicos_proyectos_timestamp
    BEFORE UPDATE ON datos_caracteristicos_proyectos
    FOR EACH ROW
    EXECUTE FUNCTION update_datos_caracteristicos_proyectos_timestamp();

\n-- Comentarios para tabla: datos_caracteristicos_proyectos\n\nCOMMENT ON TABLE datos_caracteristicos_proyectos IS 'Tabla generada automáticamente desde datos_caracteristicos_proyectos.json';\n\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.bpin IS 'Campo bpin (Tipo: timestamp)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.bp IS 'Campo bp (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_proyecto IS 'Campo nombre_proyecto (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_actividad IS 'Campo nombre_actividad (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.programa_presupuestal IS 'Campo programa_presupuestal (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_centro_gestor IS 'Campo nombre_centro_gestor (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_area_funcional IS 'Campo nombre_area_funcional (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_fondo IS 'Campo nombre_fondo (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.clasificacion_fondo IS 'Campo clasificacion_fondo (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_pospre IS 'Campo nombre_pospre (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_dimension IS 'Campo nombre_dimension (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_linea_estrategica IS 'Campo nombre_linea_estrategica (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.nombre_programa IS 'Campo nombre_programa (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.comuna IS 'Campo comuna (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.origen IS 'Campo origen (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.anio IS 'Campo anio (Tipo: integer)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.tipo_gasto IS 'Campo tipo_gasto (Tipo: varchar)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.cod_sector IS 'Campo cod_sector (Tipo: integer)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.cod_producto IS 'Campo cod_producto (Tipo: integer)';\nCOMMENT ON COLUMN datos_caracteristicos_proyectos.validador_cuipo IS 'Campo validador_cuipo (Tipo: unknown)';\n\n\n\n-- ==============================================\n-- Tabla: ejecucion_presupuestal\n-- Descripción: Tabla generada automáticamente desde ejecucion_presupuestal.json\n-- Generado: 2025-09-19T14:01:59.074206\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS ejecucion_presupuestal (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    bpin TIMESTAMP WITH TIME ZONE NOT NULL,\n    periodo_corte DATE NOT NULL,\n    ejecucion INTEGER NOT NULL,\n    pagos BOOLEAN NOT NULL,\n    ppto_disponible INTEGER NOT NULL,\n    saldos_cdp BOOLEAN NOT NULL,\n    total_acumul_obligac INTEGER NOT NULL,\n    total_acumulado_cdp INTEGER NOT NULL,\n    total_acumulado_rpc INTEGER NOT NULL,\n    dataframe_origen VARCHAR(25) NOT NULL,\n    archivo_origen TIMESTAMP WITH TIME ZONE NOT NULL\n);\n\n-- Índices para tabla: ejecucion_presupuestal\n\nCREATE INDEX IF NOT EXISTS idx_ejecucion_presupuestal_created_at ON ejecucion_presupuestal (created_at);\nCREATE INDEX IF NOT EXISTS idx_ejecucion_presupuestal_updated_at ON ejecucion_presupuestal (updated_at);\nCREATE INDEX IF NOT EXISTS idx_ejecucion_presupuestal_active ON ejecucion_presupuestal (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_ejecucion_presupuestal_bpin_analytics ON ejecucion_presupuestal (bpin);\n\n-- Constraints para tabla: ejecucion_presupuestal\n\n
-- Trigger para actualizar timestamp automáticamente en ejecucion_presupuestal
CREATE OR REPLACE FUNCTION update_ejecucion_presupuestal_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_ejecucion_presupuestal_timestamp ON ejecucion_presupuestal;
CREATE TRIGGER trigger_update_ejecucion_presupuestal_timestamp
    BEFORE UPDATE ON ejecucion_presupuestal
    FOR EACH ROW
    EXECUTE FUNCTION update_ejecucion_presupuestal_timestamp();

\n-- Comentarios para tabla: ejecucion_presupuestal\n\nCOMMENT ON TABLE ejecucion_presupuestal IS 'Tabla generada automáticamente desde ejecucion_presupuestal.json';\n\nCOMMENT ON COLUMN ejecucion_presupuestal.bpin IS 'Campo bpin (Tipo: timestamp)';\nCOMMENT ON COLUMN ejecucion_presupuestal.periodo_corte IS 'Campo periodo_corte (Tipo: date)';\nCOMMENT ON COLUMN ejecucion_presupuestal.ejecucion IS 'Campo ejecucion (Tipo: integer)';\nCOMMENT ON COLUMN ejecucion_presupuestal.pagos IS 'Campo pagos (Tipo: boolean)';\nCOMMENT ON COLUMN ejecucion_presupuestal.ppto_disponible IS 'Campo ppto_disponible (Tipo: integer)';\nCOMMENT ON COLUMN ejecucion_presupuestal.saldos_cdp IS 'Campo saldos_cdp (Tipo: boolean)';\nCOMMENT ON COLUMN ejecucion_presupuestal.total_acumul_obligac IS 'Campo total_acumul_obligac (Tipo: integer)';\nCOMMENT ON COLUMN ejecucion_presupuestal.total_acumulado_cdp IS 'Campo total_acumulado_cdp (Tipo: integer)';\nCOMMENT ON COLUMN ejecucion_presupuestal.total_acumulado_rpc IS 'Campo total_acumulado_rpc (Tipo: integer)';\nCOMMENT ON COLUMN ejecucion_presupuestal.dataframe_origen IS 'Campo dataframe_origen (Tipo: varchar)';\nCOMMENT ON COLUMN ejecucion_presupuestal.archivo_origen IS 'Campo archivo_origen (Tipo: datetime)';\n\n\n\n-- ==============================================\n-- Tabla: movimientos_presupuestales\n-- Descripción: Tabla generada automáticamente desde movimientos_presupuestales.json\n-- Generado: 2025-09-19T14:01:59.074731\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS movimientos_presupuestales (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    bpin TIMESTAMP WITH TIME ZONE NOT NULL,\n    periodo_corte DATE NOT NULL,\n    adiciones BOOLEAN NOT NULL,\n    aplazamiento BOOLEAN NOT NULL,\n    contracreditos BOOLEAN NOT NULL,\n    creditos BOOLEAN NOT NULL,\n    desaplazamiento BOOLEAN NOT NULL,\n    ppto_inicial INTEGER NOT NULL,\n    ppto_modificado INTEGER NOT NULL,\n    reducciones BOOLEAN NOT NULL,\n    dataframe_origen VARCHAR(25) NOT NULL,\n    archivo_origen TIMESTAMP WITH TIME ZONE NOT NULL\n);\n\n-- Índices para tabla: movimientos_presupuestales\n\nCREATE INDEX IF NOT EXISTS idx_movimientos_presupuestales_created_at ON movimientos_presupuestales (created_at);\nCREATE INDEX IF NOT EXISTS idx_movimientos_presupuestales_updated_at ON movimientos_presupuestales (updated_at);\nCREATE INDEX IF NOT EXISTS idx_movimientos_presupuestales_active ON movimientos_presupuestales (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_movimientos_presupuestales_bpin_analytics ON movimientos_presupuestales (bpin);\n\n-- Constraints para tabla: movimientos_presupuestales\n\n
-- Trigger para actualizar timestamp automáticamente en movimientos_presupuestales
CREATE OR REPLACE FUNCTION update_movimientos_presupuestales_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_movimientos_presupuestales_timestamp ON movimientos_presupuestales;
CREATE TRIGGER trigger_update_movimientos_presupuestales_timestamp
    BEFORE UPDATE ON movimientos_presupuestales
    FOR EACH ROW
    EXECUTE FUNCTION update_movimientos_presupuestales_timestamp();

\n-- Comentarios para tabla: movimientos_presupuestales\n\nCOMMENT ON TABLE movimientos_presupuestales IS 'Tabla generada automáticamente desde movimientos_presupuestales.json';\n\nCOMMENT ON COLUMN movimientos_presupuestales.bpin IS 'Campo bpin (Tipo: timestamp)';\nCOMMENT ON COLUMN movimientos_presupuestales.periodo_corte IS 'Campo periodo_corte (Tipo: date)';\nCOMMENT ON COLUMN movimientos_presupuestales.adiciones IS 'Campo adiciones (Tipo: boolean)';\nCOMMENT ON COLUMN movimientos_presupuestales.aplazamiento IS 'Campo aplazamiento (Tipo: boolean)';\nCOMMENT ON COLUMN movimientos_presupuestales.contracreditos IS 'Campo contracreditos (Tipo: boolean)';\nCOMMENT ON COLUMN movimientos_presupuestales.creditos IS 'Campo creditos (Tipo: boolean)';\nCOMMENT ON COLUMN movimientos_presupuestales.desaplazamiento IS 'Campo desaplazamiento (Tipo: boolean)';\nCOMMENT ON COLUMN movimientos_presupuestales.ppto_inicial IS 'Campo ppto_inicial (Tipo: integer)';\nCOMMENT ON COLUMN movimientos_presupuestales.ppto_modificado IS 'Campo ppto_modificado (Tipo: integer)';\nCOMMENT ON COLUMN movimientos_presupuestales.reducciones IS 'Campo reducciones (Tipo: boolean)';\nCOMMENT ON COLUMN movimientos_presupuestales.dataframe_origen IS 'Campo dataframe_origen (Tipo: varchar)';\nCOMMENT ON COLUMN movimientos_presupuestales.archivo_origen IS 'Campo archivo_origen (Tipo: datetime)';\n\n\n\n-- ==============================================\n-- Tabla: emp_contratos_index\n-- Descripción: Tabla generada automáticamente desde emp_contratos_index.json\n-- Generado: 2025-09-19T14:01:59.074731\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS emp_contratos_index (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    banco VARCHAR(11) NOT NULL,\n    referencia_proceso VARCHAR(24) PRIMARY KEY NOT NULL,\n    referencia_contrato VARCHAR(50),\n    fecha_extraccion DATE NOT NULL\n);\n\n-- Índices para tabla: emp_contratos_index\n\nCREATE INDEX IF NOT EXISTS idx_emp_contratos_index_created_at ON emp_contratos_index (created_at);\nCREATE INDEX IF NOT EXISTS idx_emp_contratos_index_updated_at ON emp_contratos_index (updated_at);\nCREATE INDEX IF NOT EXISTS idx_emp_contratos_index_active ON emp_contratos_index (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_emp_contratos_index_fecha_extraccion_analytics ON emp_contratos_index (fecha_extraccion);\n\n-- Constraints para tabla: emp_contratos_index\n\n
-- Trigger para actualizar timestamp automáticamente en emp_contratos_index
CREATE OR REPLACE FUNCTION update_emp_contratos_index_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_emp_contratos_index_timestamp ON emp_contratos_index;
CREATE TRIGGER trigger_update_emp_contratos_index_timestamp
    BEFORE UPDATE ON emp_contratos_index
    FOR EACH ROW
    EXECUTE FUNCTION update_emp_contratos_index_timestamp();

\n-- Comentarios para tabla: emp_contratos_index\n\nCOMMENT ON TABLE emp_contratos_index IS 'Tabla generada automáticamente desde emp_contratos_index.json';\n\nCOMMENT ON COLUMN emp_contratos_index.banco IS 'Campo banco (Tipo: varchar)';\nCOMMENT ON COLUMN emp_contratos_index.id IS 'Campo id (Tipo: integer)';\nCOMMENT ON COLUMN emp_contratos_index.referencia_proceso IS 'Campo referencia_proceso (Tipo: varchar)';\nCOMMENT ON COLUMN emp_contratos_index.referencia_contrato IS 'Campo referencia_contrato (Tipo: varchar)';\nCOMMENT ON COLUMN emp_contratos_index.fecha_extraccion IS 'Campo fecha_extraccion (Tipo: date)';\n\n\n\n-- ==============================================\n-- Tabla: emp_procesos\n-- Descripción: Tabla generada automáticamente desde emp_procesos.json\n-- Generado: 2025-09-19T14:01:59.074731\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS emp_procesos (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    banco VARCHAR(11) NOT NULL,\n    descripcion VARCHAR(1342) PRIMARY KEY NOT NULL,\n    urlproceso TEXT NOT NULL,\n    valor_total TIMESTAMP WITH TIME ZONE NOT NULL,\n    objeto VARCHAR(370) PRIMARY KEY NOT NULL,\n    valor_plataforma TIMESTAMP WITH TIME ZONE NOT NULL,\n    modalidad VARCHAR(39) NOT NULL,\n    referencia_proceso VARCHAR(24) PRIMARY KEY NOT NULL,\n    referencia_contato VARCHAR(50),\n    planeado DATE NOT NULL,\n    estado_proceso_secop VARCHAR(19) NOT NULL,\n    observaciones TIMESTAMP WITH TIME ZONE NOT NULL,\n    numero_contacto TIMESTAMP WITH TIME ZONE,\n    urlestadorealproceso TEXT NOT NULL,\n    archivo_origen VARCHAR(37) NOT NULL,\n    fecha_procesamiento DATE NOT NULL\n);\n\n-- Índices para tabla: emp_procesos\n\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_created_at ON emp_procesos (created_at);\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_updated_at ON emp_procesos (updated_at);\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_active ON emp_procesos (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_estado_proceso_secop_analytics ON emp_procesos (estado_proceso_secop);\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_urlestadorealproceso_analytics ON emp_procesos (urlestadorealproceso);\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_fecha_procesamiento_analytics ON emp_procesos (fecha_procesamiento);\n\n-- Constraints para tabla: emp_procesos\n\n
-- Trigger para actualizar timestamp automáticamente en emp_procesos
CREATE OR REPLACE FUNCTION update_emp_procesos_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_emp_procesos_timestamp ON emp_procesos;
CREATE TRIGGER trigger_update_emp_procesos_timestamp
    BEFORE UPDATE ON emp_procesos
    FOR EACH ROW
    EXECUTE FUNCTION update_emp_procesos_timestamp();

\n-- Comentarios para tabla: emp_procesos\n\nCOMMENT ON TABLE emp_procesos IS 'Tabla generada automáticamente desde emp_procesos.json';\n\nCOMMENT ON COLUMN emp_procesos.banco IS 'Campo banco (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.descripcion IS 'Campo descripcion (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.id IS 'Campo id (Tipo: integer)';\nCOMMENT ON COLUMN emp_procesos.urlproceso IS 'Campo urlproceso (Tipo: url)';\nCOMMENT ON COLUMN emp_procesos.valor_total IS 'Campo valor_total (Tipo: timestamp)';\nCOMMENT ON COLUMN emp_procesos.objeto IS 'Campo objeto (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.valor_plataforma IS 'Campo valor_plataforma (Tipo: timestamp)';\nCOMMENT ON COLUMN emp_procesos.modalidad IS 'Campo modalidad (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.referencia_proceso IS 'Campo referencia_proceso (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.referencia_contato IS 'Campo referencia_contato (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.planeado IS 'Campo planeado (Tipo: date)';\nCOMMENT ON COLUMN emp_procesos.estado_proceso_secop IS 'Campo estado_proceso_secop (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.observaciones IS 'Campo observaciones (Tipo: datetime)';\nCOMMENT ON COLUMN emp_procesos.numero_contacto IS 'Campo numero_contacto (Tipo: timestamp)';\nCOMMENT ON COLUMN emp_procesos.urlestadorealproceso IS 'Campo urlestadorealproceso (Tipo: url)';\nCOMMENT ON COLUMN emp_procesos.archivo_origen IS 'Campo archivo_origen (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos.fecha_procesamiento IS 'Campo fecha_procesamiento (Tipo: date)';\n\n\n\n-- ==============================================\n-- Tabla: emp_procesos_index\n-- Descripción: Tabla generada automáticamente desde emp_procesos_index.json\n-- Generado: 2025-09-19T14:01:59.074731\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS emp_procesos_index (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    banco VARCHAR(11) NOT NULL,\n    referencia_proceso VARCHAR(24) PRIMARY KEY NOT NULL,\n    fecha_procesamiento DATE NOT NULL,\n    urlestadorealproceso TEXT NOT NULL,\n    proceso_compra VARCHAR(16)\n);\n\n-- Índices para tabla: emp_procesos_index\n\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_index_created_at ON emp_procesos_index (created_at);\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_index_updated_at ON emp_procesos_index (updated_at);\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_index_active ON emp_procesos_index (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_index_fecha_procesamiento_analytics ON emp_procesos_index (fecha_procesamiento);\nCREATE INDEX IF NOT EXISTS idx_emp_procesos_index_urlestadorealproceso_analytics ON emp_procesos_index (urlestadorealproceso);\n\n-- Constraints para tabla: emp_procesos_index\n\n
-- Trigger para actualizar timestamp automáticamente en emp_procesos_index
CREATE OR REPLACE FUNCTION update_emp_procesos_index_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_emp_procesos_index_timestamp ON emp_procesos_index;
CREATE TRIGGER trigger_update_emp_procesos_index_timestamp
    BEFORE UPDATE ON emp_procesos_index
    FOR EACH ROW
    EXECUTE FUNCTION update_emp_procesos_index_timestamp();

\n-- Comentarios para tabla: emp_procesos_index\n\nCOMMENT ON TABLE emp_procesos_index IS 'Tabla generada automáticamente desde emp_procesos_index.json';\n\nCOMMENT ON COLUMN emp_procesos_index.banco IS 'Campo banco (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos_index.id IS 'Campo id (Tipo: integer)';\nCOMMENT ON COLUMN emp_procesos_index.referencia_proceso IS 'Campo referencia_proceso (Tipo: varchar)';\nCOMMENT ON COLUMN emp_procesos_index.fecha_procesamiento IS 'Campo fecha_procesamiento (Tipo: date)';\nCOMMENT ON COLUMN emp_procesos_index.urlestadorealproceso IS 'Campo urlestadorealproceso (Tipo: url)';\nCOMMENT ON COLUMN emp_procesos_index.proceso_compra IS 'Campo proceso_compra (Tipo: varchar)';\n\n\n\n-- ==============================================\n-- Tabla: emp_proyectos\n-- Descripción: Tabla generada automáticamente desde emp_proyectos.json\n-- Generado: 2025-09-19T14:01:59.075260\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS emp_proyectos (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    bp VARCHAR(11) PRIMARY KEY NOT NULL,\n    banco VARCHAR(18),\n    nombre_comercial VARCHAR(53) NOT NULL,\n    bpin TIMESTAMP WITH TIME ZONE,\n    fecha_procesamiento DATE NOT NULL\n);\n\n-- Índices para tabla: emp_proyectos\n\nCREATE INDEX IF NOT EXISTS idx_emp_proyectos_created_at ON emp_proyectos (created_at);\nCREATE INDEX IF NOT EXISTS idx_emp_proyectos_updated_at ON emp_proyectos (updated_at);\nCREATE INDEX IF NOT EXISTS idx_emp_proyectos_active ON emp_proyectos (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_emp_proyectos_nombre_comercial_analytics ON emp_proyectos (nombre_comercial);\nCREATE INDEX IF NOT EXISTS idx_emp_proyectos_bpin_analytics ON emp_proyectos (bpin);\nCREATE INDEX IF NOT EXISTS idx_emp_proyectos_fecha_procesamiento_analytics ON emp_proyectos (fecha_procesamiento);\n\n-- Constraints para tabla: emp_proyectos\n\n
-- Trigger para actualizar timestamp automáticamente en emp_proyectos
CREATE OR REPLACE FUNCTION update_emp_proyectos_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_emp_proyectos_timestamp ON emp_proyectos;
CREATE TRIGGER trigger_update_emp_proyectos_timestamp
    BEFORE UPDATE ON emp_proyectos
    FOR EACH ROW
    EXECUTE FUNCTION update_emp_proyectos_timestamp();

\n-- Comentarios para tabla: emp_proyectos\n\nCOMMENT ON TABLE emp_proyectos IS 'Tabla generada automáticamente desde emp_proyectos.json';\n\nCOMMENT ON COLUMN emp_proyectos.bp IS 'Campo bp (Tipo: varchar)';\nCOMMENT ON COLUMN emp_proyectos.banco IS 'Campo banco (Tipo: varchar)';\nCOMMENT ON COLUMN emp_proyectos.nombre_comercial IS 'Campo nombre_comercial (Tipo: varchar)';\nCOMMENT ON COLUMN emp_proyectos.bpin IS 'Campo bpin (Tipo: timestamp)';\nCOMMENT ON COLUMN emp_proyectos.fecha_procesamiento IS 'Campo fecha_procesamiento (Tipo: date)';\n\n\n\n-- ==============================================\n-- Tabla: procesos_secop\n-- Descripción: Tabla generada automáticamente desde procesos_secop.json\n-- Generado: 2025-09-19T14:01:59.075260\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS procesos_secop (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    entidad VARCHAR(118) NOT NULL,\n    entidad_centralizada VARCHAR(15) NOT NULL,\n    id_proceso VARCHAR(15) NOT NULL,\n    referencia_proceso VARCHAR(117) NOT NULL,\n    pci INTEGER NOT NULL,\n    proceso_compra VARCHAR(16) NOT NULL,\n    nombre_procedimiento VARCHAR(200) NOT NULL,\n    descripci_n_procedimiento TIMESTAMP WITH TIME ZONE NOT NULL,\n    fase VARCHAR(43),\n    fecha_publicacion_proceso DATE,\n    fecha_ultima_publicaci_n DATE,\n    fecha_publicacion_fase_planeacion_precalificacion TEXT,\n    fecha_publicacion_fase_seleccion_precalificacion TEXT,\n    fecha_publicacion_manifestacion_interes DATE,\n    fecha_publicacion_fase_borrador DATE,\n    fecha_publicacion_fase_seleccion DATE,\n    precio_base INTEGER NOT NULL,\n    modalidad_contratacion VARCHAR(59) NOT NULL,\n    justificaci_n_modalidad_contrataci_n TIMESTAMP WITH TIME ZONE NOT NULL,\n    duracion INTEGER NOT NULL,\n    unidad_duracion VARCHAR(9) NOT NULL,\n    fecha_recepcion_respuestas DATE,\n    fecha_apertura_respuesta DATE,\n    fecha_apertura_efectiva DATE,\n    ciudad_unidad_contrataci_n VARCHAR(9) NOT NULL,\n    nombre_unidad_contrataci_n VARCHAR(67) NOT NULL,\n    proveedores_invitados BOOLEAN NOT NULL,\n    proveedores_invitacion_directa BOOLEAN NOT NULL,\n    visualizaciones_procedimiento INTEGER NOT NULL,\n    proveedores_que_manifestaron_interes BOOLEAN NOT NULL,\n    respuestas_al_procedimiento BOOLEAN NOT NULL,\n    respuestas_externas BOOLEAN NOT NULL,\n    conteo_respuestas_ofertas BOOLEAN NOT NULL,\n    proveedores_unicos_respuestas BOOLEAN NOT NULL,\n    numero_lotes BOOLEAN NOT NULL,\n    estado_procedimiento VARCHAR(12) NOT NULL,\n    id_estado_procedimiento INTEGER NOT NULL,\n    adjudicado VARCHAR(2) NOT NULL,\n    id_adjudicacion VARCHAR(15) NOT NULL,\n    codigoproveedor INTEGER NOT NULL,\n    departamento_proveedor VARCHAR(26) NOT NULL,\n    ciudad_proveedor VARCHAR(22) NOT NULL,\n    fecha_adjudicacion DATE,\n    valor_total_adjudicacion INTEGER NOT NULL,\n    nombre_adjudicador VARCHAR(46) NOT NULL,\n    nombre_proveedor_adjudicado VARCHAR(119) NOT NULL,\n    nit_proveedor_adjudicado INTEGER NOT NULL,\n    codigo_principal_categoria VARCHAR(11) NOT NULL,\n    estado_apertura_proceso VARCHAR(7) NOT NULL,\n    tipo_contrato VARCHAR(30) NOT NULL,\n    subtipo_contrato VARCHAR(11) NOT NULL,\n    urlproceso TEXT NOT NULL,\n    estado_resumen VARCHAR(40) NOT NULL\n);\n\n-- Índices para tabla: procesos_secop\n\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_created_at ON procesos_secop (created_at);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_updated_at ON procesos_secop (updated_at);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_active ON procesos_secop (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_nombre_procedimiento_analytics ON procesos_secop (nombre_procedimiento);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_publicacion_proceso_analytics ON procesos_secop (fecha_publicacion_proceso);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_ultima_publicaci_n_analytics ON procesos_secop (fecha_ultima_publicaci_n);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_publicacion_fase_planeacion_precalificacion_analytics ON procesos_secop (fecha_publicacion_fase_planeacion_precalificacion);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_publicacion_fase_seleccion_precalificacion_analytics ON procesos_secop (fecha_publicacion_fase_seleccion_precalificacion);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_publicacion_manifestacion_interes_analytics ON procesos_secop (fecha_publicacion_manifestacion_interes);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_publicacion_fase_borrador_analytics ON procesos_secop (fecha_publicacion_fase_borrador);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_publicacion_fase_seleccion_analytics ON procesos_secop (fecha_publicacion_fase_seleccion);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_recepcion_respuestas_analytics ON procesos_secop (fecha_recepcion_respuestas);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_apertura_respuesta_analytics ON procesos_secop (fecha_apertura_respuesta);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_apertura_efectiva_analytics ON procesos_secop (fecha_apertura_efectiva);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_nombre_unidad_contrataci_n_analytics ON procesos_secop (nombre_unidad_contrataci_n);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_estado_procedimiento_analytics ON procesos_secop (estado_procedimiento);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_id_estado_procedimiento_analytics ON procesos_secop (id_estado_procedimiento);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_codigoproveedor_analytics ON procesos_secop (codigoproveedor);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_fecha_adjudicacion_analytics ON procesos_secop (fecha_adjudicacion);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_nombre_adjudicador_analytics ON procesos_secop (nombre_adjudicador);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_nombre_proveedor_adjudicado_analytics ON procesos_secop (nombre_proveedor_adjudicado);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_codigo_principal_categoria_analytics ON procesos_secop (codigo_principal_categoria);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_estado_apertura_proceso_analytics ON procesos_secop (estado_apertura_proceso);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_tipo_contrato_analytics ON procesos_secop (tipo_contrato);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_subtipo_contrato_analytics ON procesos_secop (subtipo_contrato);\nCREATE INDEX IF NOT EXISTS idx_procesos_secop_estado_resumen_analytics ON procesos_secop (estado_resumen);\n\n-- Constraints para tabla: procesos_secop\n\nALTER TABLE procesos_secop ADD CONSTRAINT chk_procesos_secop_precio_base_positive\n    CHECK (precio_base >= 0);\n\nALTER TABLE procesos_secop ADD CONSTRAINT chk_procesos_secop_valor_total_adjudicacion_positive\n    CHECK (valor_total_adjudicacion >= 0);\n\n
-- Trigger para actualizar timestamp automáticamente en procesos_secop
CREATE OR REPLACE FUNCTION update_procesos_secop_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_procesos_secop_timestamp ON procesos_secop;
CREATE TRIGGER trigger_update_procesos_secop_timestamp
    BEFORE UPDATE ON procesos_secop
    FOR EACH ROW
    EXECUTE FUNCTION update_procesos_secop_timestamp();

\n-- Comentarios para tabla: procesos_secop\n\nCOMMENT ON TABLE procesos_secop IS 'Tabla generada automáticamente desde procesos_secop.json';\n\nCOMMENT ON COLUMN procesos_secop.entidad IS 'Campo entidad (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.entidad_centralizada IS 'Campo entidad_centralizada (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.id_proceso IS 'Campo id_proceso (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.referencia_proceso IS 'Campo referencia_proceso (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.pci IS 'Campo pci (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.proceso_compra IS 'Campo proceso_compra (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.nombre_procedimiento IS 'Campo nombre_procedimiento (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.descripci_n_procedimiento IS 'Campo descripci_n_procedimiento (Tipo: datetime)';\nCOMMENT ON COLUMN procesos_secop.fase IS 'Campo fase (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.fecha_publicacion_proceso IS 'Campo fecha_publicacion_proceso (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.fecha_ultima_publicaci_n IS 'Campo fecha_ultima_publicaci_n (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.fecha_publicacion_fase_planeacion_precalificacion IS 'Campo fecha_publicacion_fase_planeacion_precalificacion (Tipo: unknown)';\nCOMMENT ON COLUMN procesos_secop.fecha_publicacion_fase_seleccion_precalificacion IS 'Campo fecha_publicacion_fase_seleccion_precalificacion (Tipo: unknown)';\nCOMMENT ON COLUMN procesos_secop.fecha_publicacion_manifestacion_interes IS 'Campo fecha_publicacion_manifestacion_interes (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.fecha_publicacion_fase_borrador IS 'Campo fecha_publicacion_fase_borrador (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.fecha_publicacion_fase_seleccion IS 'Campo fecha_publicacion_fase_seleccion (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.precio_base IS 'Campo precio_base (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.modalidad_contratacion IS 'Campo modalidad_contratacion (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.justificaci_n_modalidad_contrataci_n IS 'Campo justificaci_n_modalidad_contrataci_n (Tipo: datetime)';\nCOMMENT ON COLUMN procesos_secop.duracion IS 'Campo duracion (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.unidad_duracion IS 'Campo unidad_duracion (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.fecha_recepcion_respuestas IS 'Campo fecha_recepcion_respuestas (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.fecha_apertura_respuesta IS 'Campo fecha_apertura_respuesta (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.fecha_apertura_efectiva IS 'Campo fecha_apertura_efectiva (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.ciudad_unidad_contrataci_n IS 'Campo ciudad_unidad_contrataci_n (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.nombre_unidad_contrataci_n IS 'Campo nombre_unidad_contrataci_n (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.proveedores_invitados IS 'Campo proveedores_invitados (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.proveedores_invitacion_directa IS 'Campo proveedores_invitacion_directa (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.visualizaciones_procedimiento IS 'Campo visualizaciones_procedimiento (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.proveedores_que_manifestaron_interes IS 'Campo proveedores_que_manifestaron_interes (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.respuestas_al_procedimiento IS 'Campo respuestas_al_procedimiento (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.respuestas_externas IS 'Campo respuestas_externas (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.conteo_respuestas_ofertas IS 'Campo conteo_respuestas_ofertas (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.proveedores_unicos_respuestas IS 'Campo proveedores_unicos_respuestas (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.numero_lotes IS 'Campo numero_lotes (Tipo: boolean)';\nCOMMENT ON COLUMN procesos_secop.estado_procedimiento IS 'Campo estado_procedimiento (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.id_estado_procedimiento IS 'Campo id_estado_procedimiento (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.adjudicado IS 'Campo adjudicado (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.id_adjudicacion IS 'Campo id_adjudicacion (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.codigoproveedor IS 'Campo codigoproveedor (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.departamento_proveedor IS 'Campo departamento_proveedor (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.ciudad_proveedor IS 'Campo ciudad_proveedor (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.fecha_adjudicacion IS 'Campo fecha_adjudicacion (Tipo: date)';\nCOMMENT ON COLUMN procesos_secop.valor_total_adjudicacion IS 'Campo valor_total_adjudicacion (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.nombre_adjudicador IS 'Campo nombre_adjudicador (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.nombre_proveedor_adjudicado IS 'Campo nombre_proveedor_adjudicado (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.nit_proveedor_adjudicado IS 'Campo nit_proveedor_adjudicado (Tipo: integer)';\nCOMMENT ON COLUMN procesos_secop.codigo_principal_categoria IS 'Campo codigo_principal_categoria (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.estado_apertura_proceso IS 'Campo estado_apertura_proceso (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.tipo_contrato IS 'Campo tipo_contrato (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.subtipo_contrato IS 'Campo subtipo_contrato (Tipo: varchar)';\nCOMMENT ON COLUMN procesos_secop.urlproceso IS 'Campo urlproceso (Tipo: url)';\nCOMMENT ON COLUMN procesos_secop.estado_resumen IS 'Campo estado_resumen (Tipo: varchar)';\n\n\n\n-- ==============================================\n-- Tabla: unidad_proyecto_infraestructura_equipamientos\n-- Descripción: Tabla generada automáticamente desde unidad_proyecto_infraestructura_equipamientos.json\n-- Generado: 2025-09-19T14:01:59.075785\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS unidad_proyecto_infraestructura_equipamientos (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    bpin TIMESTAMP WITH TIME ZONE NOT NULL,\n    identificador TIMESTAMP WITH TIME ZONE NOT NULL,\n    cod_fuente_financiamiento VARCHAR(48),\n    usuarios_beneficiarios NUMERIC(6, 1) NOT NULL,\n    dataframe TIMESTAMP WITH TIME ZONE NOT NULL,\n    nickname VARCHAR(51) NOT NULL,\n    nickname_detalle VARCHAR(27),\n    comuna_corregimiento TIMESTAMP WITH TIME ZONE NOT NULL,\n    barrio_vereda VARCHAR(36) NOT NULL,\n    direccion TIMESTAMP WITH TIME ZONE NOT NULL,\n    clase_obra VARCHAR(25) NOT NULL,\n    subclase_obra VARCHAR(48),\n    tipo_intervencion VARCHAR(13) NOT NULL,\n    descripcion_intervencion VARCHAR(408),\n    estado_unidad_proyecto VARCHAR(12) NOT NULL,\n    fecha_inicio_planeado TEXT,\n    fecha_fin_planeado TEXT,\n    fecha_inicio_real TEXT,\n    fecha_fin_real TEXT,\n    es_centro_gravedad BOOLEAN NOT NULL,\n    ppto_base NUMERIC(13, 1) NOT NULL,\n    pagos_realizados NUMERIC(3, 1) NOT NULL,\n    avance_f_sico_obra NUMERIC(4, 2) NOT NULL,\n    ejecucion_financiera_obra NUMERIC(3, 1) NOT NULL,\n    geom TIMESTAMP WITH TIME ZONE NOT NULL\n);\n\n-- Índices para tabla: unidad_proyecto_infraestructura_equipamientos\n\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_created_at ON unidad_proyecto_infraestructura_equipamientos (created_at);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_updated_at ON unidad_proyecto_infraestructura_equipamientos (updated_at);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_active ON unidad_proyecto_infraestructura_equipamientos (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_bpin_analytics ON unidad_proyecto_infraestructura_equipamientos (bpin);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_tipo_intervencion_analytics ON unidad_proyecto_infraestructura_equipamientos (tipo_intervencion);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_estado_unidad_proyecto_analytics ON unidad_proyecto_infraestructura_equipamientos (estado_unidad_proyecto);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_fecha_inicio_planeado_analytics ON unidad_proyecto_infraestructura_equipamientos (fecha_inicio_planeado);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_fecha_fin_planeado_analytics ON unidad_proyecto_infraestructura_equipamientos (fecha_fin_planeado);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_fecha_inicio_real_analytics ON unidad_proyecto_infraestructura_equipamientos (fecha_inicio_real);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_equipamientos_fecha_fin_real_analytics ON unidad_proyecto_infraestructura_equipamientos (fecha_fin_real);\n\n-- Constraints para tabla: unidad_proyecto_infraestructura_equipamientos\n\n
-- Trigger para actualizar timestamp automáticamente en unidad_proyecto_infraestructura_equipamientos
CREATE OR REPLACE FUNCTION update_unidad_proyecto_infraestructura_equipamientos_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_unidad_proyecto_infraestructura_equipamientos_timestamp ON unidad_proyecto_infraestructura_equipamientos;
CREATE TRIGGER trigger_update_unidad_proyecto_infraestructura_equipamientos_timestamp
    BEFORE UPDATE ON unidad_proyecto_infraestructura_equipamientos
    FOR EACH ROW
    EXECUTE FUNCTION update_unidad_proyecto_infraestructura_equipamientos_timestamp();

\n-- Comentarios para tabla: unidad_proyecto_infraestructura_equipamientos\n\nCOMMENT ON TABLE unidad_proyecto_infraestructura_equipamientos IS 'Tabla generada automáticamente desde unidad_proyecto_infraestructura_equipamientos.json';\n\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.bpin IS 'Campo bpin (Tipo: timestamp)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.identificador IS 'Campo identificador (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.cod_fuente_financiamiento IS 'Campo cod_fuente_financiamiento (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.usuarios_beneficiarios IS 'Campo usuarios_beneficiarios (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.dataframe IS 'Campo dataframe (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.nickname IS 'Campo nickname (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.nickname_detalle IS 'Campo nickname_detalle (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.comuna_corregimiento IS 'Campo comuna_corregimiento (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.barrio_vereda IS 'Campo barrio_vereda (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.direccion IS 'Campo direccion (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.clase_obra IS 'Campo clase_obra (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.subclase_obra IS 'Campo subclase_obra (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.tipo_intervencion IS 'Campo tipo_intervencion (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.descripcion_intervencion IS 'Campo descripcion_intervencion (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.estado_unidad_proyecto IS 'Campo estado_unidad_proyecto (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.fecha_inicio_planeado IS 'Campo fecha_inicio_planeado (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.fecha_fin_planeado IS 'Campo fecha_fin_planeado (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.fecha_inicio_real IS 'Campo fecha_inicio_real (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.fecha_fin_real IS 'Campo fecha_fin_real (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.es_centro_gravedad IS 'Campo es_centro_gravedad (Tipo: boolean)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.ppto_base IS 'Campo ppto_base (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.pagos_realizados IS 'Campo pagos_realizados (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.avance_f_sico_obra IS 'Campo avance_f_sico_obra (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.ejecucion_financiera_obra IS 'Campo ejecucion_financiera_obra (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_equipamientos.geom IS 'Campo geom (Tipo: datetime)';\n\n\n\n-- ==============================================\n-- Tabla: unidad_proyecto_infraestructura_vial\n-- Descripción: Tabla generada automáticamente desde unidad_proyecto_infraestructura_vial.json\n-- Generado: 2025-09-19T14:01:59.075785\n-- ==============================================\n\nCREATE TABLE IF NOT EXISTS unidad_proyecto_infraestructura_vial (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,\n    version INTEGER DEFAULT 1 NOT NULL,\n    is_active BOOLEAN DEFAULT true NOT NULL,\n    bpin TIMESTAMP WITH TIME ZONE NOT NULL,\n    identificador TIMESTAMP WITH TIME ZONE NOT NULL,\n    id_via TIMESTAMP WITH TIME ZONE NOT NULL,\n    cod_fuente_financiamiento VARCHAR(10) NOT NULL,\n    usuarios_beneficiarios NUMERIC(3, 1) NOT NULL,\n    dataframe VARCHAR(30) NOT NULL,\n    nickname TIMESTAMP WITH TIME ZONE NOT NULL,\n    nickname_detalle TEXT,\n    comuna_corregimiento TIMESTAMP WITH TIME ZONE NOT NULL,\n    barrio_vereda VARCHAR(16) NOT NULL,\n    direccion TEXT,\n    clase_obra VARCHAR(29) NOT NULL,\n    subclase_obra TEXT,\n    tipo_intervencion VARCHAR(38) NOT NULL,\n    descripcion_intervencion VARCHAR(57),\n    estado_unidad_proyecto VARCHAR(12) NOT NULL,\n    unidad_medicion VARCHAR(1) NOT NULL,\n    fecha_inicio_planeado TEXT,\n    fecha_fin_planeado TEXT,\n    fecha_inicio_real TEXT,\n    fecha_fin_real TEXT,\n    es_centro_gravedad BOOLEAN NOT NULL,\n    longitud_proyectada NUMERIC(7, 2) NOT NULL,\n    longitud_ejecutada NUMERIC(3, 1) NOT NULL,\n    ppto_base NUMERIC(12, 1) NOT NULL,\n    pagos_realizados NUMERIC(3, 1) NOT NULL,\n    avance_f_sico_obra NUMERIC(3, 1) NOT NULL,\n    ejecucion_financiera_obra NUMERIC(3, 1) NOT NULL,\n    geom TIMESTAMP WITH TIME ZONE NOT NULL\n);\n\n-- Índices para tabla: unidad_proyecto_infraestructura_vial\n\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_created_at ON unidad_proyecto_infraestructura_vial (created_at);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_updated_at ON unidad_proyecto_infraestructura_vial (updated_at);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_active ON unidad_proyecto_infraestructura_vial (is_active) WHERE is_active = true;\n\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_bpin_analytics ON unidad_proyecto_infraestructura_vial (bpin);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_tipo_intervencion_analytics ON unidad_proyecto_infraestructura_vial (tipo_intervencion);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_estado_unidad_proyecto_analytics ON unidad_proyecto_infraestructura_vial (estado_unidad_proyecto);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_fecha_inicio_planeado_analytics ON unidad_proyecto_infraestructura_vial (fecha_inicio_planeado);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_fecha_fin_planeado_analytics ON unidad_proyecto_infraestructura_vial (fecha_fin_planeado);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_fecha_inicio_real_analytics ON unidad_proyecto_infraestructura_vial (fecha_inicio_real);\nCREATE INDEX IF NOT EXISTS idx_unidad_proyecto_infraestructura_vial_fecha_fin_real_analytics ON unidad_proyecto_infraestructura_vial (fecha_fin_real);\n\n-- Constraints para tabla: unidad_proyecto_infraestructura_vial\n\n
-- Trigger para actualizar timestamp automáticamente en unidad_proyecto_infraestructura_vial
CREATE OR REPLACE FUNCTION update_unidad_proyecto_infraestructura_vial_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    NEW.version = OLD.version + 1;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_unidad_proyecto_infraestructura_vial_timestamp ON unidad_proyecto_infraestructura_vial;
CREATE TRIGGER trigger_update_unidad_proyecto_infraestructura_vial_timestamp
    BEFORE UPDATE ON unidad_proyecto_infraestructura_vial
    FOR EACH ROW
    EXECUTE FUNCTION update_unidad_proyecto_infraestructura_vial_timestamp();

\n-- Comentarios para tabla: unidad_proyecto_infraestructura_vial\n\nCOMMENT ON TABLE unidad_proyecto_infraestructura_vial IS 'Tabla generada automáticamente desde unidad_proyecto_infraestructura_vial.json';\n\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.bpin IS 'Campo bpin (Tipo: timestamp)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.identificador IS 'Campo identificador (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.id_via IS 'Campo id_via (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.cod_fuente_financiamiento IS 'Campo cod_fuente_financiamiento (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.usuarios_beneficiarios IS 'Campo usuarios_beneficiarios (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.dataframe IS 'Campo dataframe (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.nickname IS 'Campo nickname (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.nickname_detalle IS 'Campo nickname_detalle (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.comuna_corregimiento IS 'Campo comuna_corregimiento (Tipo: datetime)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.barrio_vereda IS 'Campo barrio_vereda (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.direccion IS 'Campo direccion (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.clase_obra IS 'Campo clase_obra (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.subclase_obra IS 'Campo subclase_obra (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.tipo_intervencion IS 'Campo tipo_intervencion (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.descripcion_intervencion IS 'Campo descripcion_intervencion (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.estado_unidad_proyecto IS 'Campo estado_unidad_proyecto (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.unidad_medicion IS 'Campo unidad_medicion (Tipo: varchar)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.fecha_inicio_planeado IS 'Campo fecha_inicio_planeado (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.fecha_fin_planeado IS 'Campo fecha_fin_planeado (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.fecha_inicio_real IS 'Campo fecha_inicio_real (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.fecha_fin_real IS 'Campo fecha_fin_real (Tipo: unknown)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.es_centro_gravedad IS 'Campo es_centro_gravedad (Tipo: boolean)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.longitud_proyectada IS 'Campo longitud_proyectada (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.longitud_ejecutada IS 'Campo longitud_ejecutada (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.ppto_base IS 'Campo ppto_base (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.pagos_realizados IS 'Campo pagos_realizados (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.avance_f_sico_obra IS 'Campo avance_f_sico_obra (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.ejecucion_financiera_obra IS 'Campo ejecucion_financiera_obra (Tipo: numeric)';\nCOMMENT ON COLUMN unidad_proyecto_infraestructura_vial.geom IS 'Campo geom (Tipo: datetime)';\n\n\n\n-- ==============================================\n-- VISTAS MATERIALIZADAS PARA ANALYTICS\n-- ==============================================\n\n-- Vista resumen de proyectos\nCREATE MATERIALIZED VIEW IF NOT EXISTS analytics.resumen_proyectos AS\nSELECT\n    COUNT(*) as total_proyectos,\n    SUM(CASE WHEN is_active THEN 1 ELSE 0 END) as proyectos_activos,\n    EXTRACT(YEAR FROM created_at) as año,\n    EXTRACT(MONTH FROM created_at) as mes\nFROM datos_caracteristicos_proyectos\nGROUP BY EXTRACT(YEAR FROM created_at), EXTRACT(MONTH FROM created_at);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_resumen_proyectos_año_mes\n    ON analytics.resumen_proyectos (año, mes);\n\n-- Vista resumen de contratos\nCREATE MATERIALIZED VIEW IF NOT EXISTS analytics.resumen_contratos AS\nSELECT\n    COUNT(*) as total_contratos,\n    SUM(valor_contrato) as valor_total,\n    AVG(valor_contrato) as valor_promedio,\n    estado_contrato,\n    DATE_TRUNC('month', created_at) as periodo\nFROM contratos_proyectos\nWHERE is_active = true\nGROUP BY estado_contrato, DATE_TRUNC('month', created_at);\n\nCREATE INDEX IF NOT EXISTS idx_resumen_contratos_estado_periodo\n    ON analytics.resumen_contratos (estado_contrato, periodo);\n\n-- Función para refrescar todas las vistas materializadas\nCREATE OR REPLACE FUNCTION analytics.refresh_all_views()\nRETURNS void AS $$\nBEGIN\n    REFRESH MATERIALIZED VIEW CONCURRENTLY analytics.resumen_proyectos;\n    REFRESH MATERIALIZED VIEW CONCURRENTLY analytics.resumen_contratos;\n    \n    -- Log de actualización\n    INSERT INTO historical.change_log (table_name, operation, changed_by, changed_at)\n    VALUES ('analytics_views', 'REFRESH', current_user, CURRENT_TIMESTAMP);\nEND;\n$$ LANGUAGE plpgsql;\n