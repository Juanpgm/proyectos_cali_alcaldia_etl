-- ==============================================\n-- SCRIPT DE MIGRACIÓN DE DATOS EXISTENTES\n-- ==============================================\n\n-- Backup de tablas existentes antes de migración\nDO $$\nDECLARE\n    table_record RECORD;\nBEGIN\n    FOR table_record IN\n        SELECT table_name FROM information_schema.tables\n        WHERE table_schema = 'public'\n        AND table_type = 'BASE TABLE'\n    LOOP\n        EXECUTE format('CREATE TABLE IF NOT EXISTS historical.backup_%s AS SELECT * FROM %I;',\n                      table_record.table_name, table_record.table_name);\n        \n        RAISE NOTICE 'Backup creado para tabla: %', table_record.table_name;\n    END LOOP;\nEND $$;\n\n-- Migración para contratos_proyectos\nINSERT INTO contratos_proyectos (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para datos_caracteristicos_proyectos\nINSERT INTO datos_caracteristicos_proyectos (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para ejecucion_presupuestal\nINSERT INTO ejecucion_presupuestal (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para movimientos_presupuestales\nINSERT INTO movimientos_presupuestales (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para emp_contratos_index\nINSERT INTO emp_contratos_index (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para emp_procesos\nINSERT INTO emp_procesos (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para emp_procesos_index\nINSERT INTO emp_procesos_index (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para emp_proyectos\nINSERT INTO emp_proyectos (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para procesos_secop\nINSERT INTO procesos_secop (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para unidad_proyecto_infraestructura_equipamientos\nINSERT INTO unidad_proyecto_infraestructura_equipamientos (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n\n-- Migración para unidad_proyecto_infraestructura_vial\nINSERT INTO unidad_proyecto_infraestructura_vial (\n    -- Mapear campos existentes a nuevos campos\n    -- NOTA: Personalizar según estructura existente\n    SELECT * FROM staging.temp_{table_name}\n    ON CONFLICT (id) DO UPDATE SET\n        updated_at = EXCLUDED.updated_at,\n        version = {table_name}.version + 1\n);\n